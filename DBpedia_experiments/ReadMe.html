<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Downloading and Preprocessing DBpedia 2022-03 for Knowledge Graph Embeddings &mdash; DICE Embeddings 0.1.3.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8775fe07" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/theme.css?v=ea877efc" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_tweak.css?v=f0ad19f3" />
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8775fe07" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c6726a90"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DICE Embeddings
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html">Dicee Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#download-knowledge-graphs">Download Knowledge Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#knowledge-graph-embedding-models">Knowledge Graph Embedding Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#how-to-train">How to Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#creating-an-embedding-vector-database">Creating an Embedding Vector Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#answering-complex-queries">Answering Complex Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#predicting-missing-links">Predicting Missing Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#downloading-pretrained-models">Downloading Pretrained Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#how-to-deploy">How to Deploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#docker">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#coverage-report">Coverage Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/main.html#how-to-cite">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/dicee/index.html">dicee</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DICE Embeddings</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Downloading and Preprocessing DBpedia 2022-03 for Knowledge Graph Embeddings</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/DBpedia_experiments/ReadMe.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="downloading-and-preprocessing-dbpedia-2022-03-for-knowledge-graph-embeddings">
<h1>Downloading and Preprocessing DBpedia 2022-03 for Knowledge Graph Embeddings<a class="headerlink" href="#downloading-and-preprocessing-dbpedia-2022-03-for-knowledge-graph-embeddings" title="Link to this heading"></a></h1>
<section id="download-files">
<h2>Download files<a class="headerlink" href="#download-files" title="Link to this heading"></a></h2>
<p>Download EN DBpedia 2022 through executing the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>FullDBpedia<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>FullDBpedia
<span class="nv">query</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept:text/sparql&quot;</span><span class="w"> </span>https://databus.dbpedia.org/dbpedia/collections/dbpedia-snapshot-2022-03<span class="k">)</span>
<span class="nv">files</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: text/csv&quot;</span><span class="w"> </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;query=</span><span class="si">${</span><span class="nv">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>https://databus.dbpedia.org/repo/sparql<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n+2<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/&quot;//g&#39;</span><span class="k">)</span>
<span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>file<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>wget<span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$files</span><span class="s2">&quot;</span><span class="w"> </span>
<span class="k">for</span><span class="w"> </span>f<span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>mv<span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;train_</span><span class="nv">$f</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="c1"># DBpedia did not zip these files. Dask throws an error if all files are not in the same format</span>
bzip2<span class="w"> </span>train_ontology--DEV_type<span class="se">\=</span>parsed.nt
bzip2<span class="w"> </span>train_ontology--DEV_type<span class="se">\=</span>parsed_sorted.nt
<span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>from<span class="w"> </span>dask<span class="w"> </span>import<span class="w"> </span>dataframe<span class="w"> </span>as<span class="w"> </span>ddf
<span class="nv">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ddf.read_csv<span class="o">(</span><span class="s1">&#39;FullDBpedia/train&#39;</span><span class="w"> </span>+<span class="s1">&#39;*&#39;</span>,delim_whitespace<span class="o">=</span>True,header<span class="o">=</span>None,usecols<span class="o">=[</span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span>,names<span class="o">=[</span><span class="s1">&#39;subject&#39;</span>,<span class="w"> </span><span class="s1">&#39;relation&#39;</span>,<span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="o">]</span>,dtype<span class="o">=</span>str<span class="o">)</span>
<span class="nv">df</span><span class="o">=</span>df.compute<span class="o">()</span>
print<span class="o">(</span>len<span class="o">(</span>df<span class="o">))</span><span class="w"> </span><span class="c1"># 1,127,738,988</span>
df.to_parquet<span class="o">(</span><span class="s2">&quot;dbpedia_03_2022.parquet&quot;</span>,<span class="w"> </span><span class="nv">engine</span><span class="o">=</span><span class="s1">&#39;pyarrow&#39;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="filtering-triples">
<h2>Filtering Triples<a class="headerlink" href="#filtering-triples" title="Link to this heading"></a></h2>
<p>We are only interested in <strong>particular triples</strong>.</p>
<section id="remove-all-literals">
<h3>Remove all literals<a class="headerlink" href="#remove-all-literals" title="Link to this heading"></a></h3>
<p>df = df[df[“object”].str.startswith(‘&lt;’,na=False)]
len(df) =&gt;  799873202</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>df.relation.value_counts()
<a class="reference external" href="http://dbpedia.org/ontology/wikiPageWikiLink">http://dbpedia.org/ontology/wikiPageWikiLink</a>        243103258
<a class="reference external" href="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">http://www.w3.org/1999/02/22-rdf-syntax-ns#type</a>     149152137
<a class="reference external" href="http://www.w3.org/2002/07/owl#sameAs">http://www.w3.org/2002/07/owl#sameAs</a>                139366172
<a class="reference external" href="http://dbpedia.org/property/wikiPageUsesTemplate">http://dbpedia.org/property/wikiPageUsesTemplate</a>     60755075
<a class="reference external" href="http://purl.org/dc/terms/subject">http://purl.org/dc/terms/subject</a>                     34356092
…<br />
<a class="reference external" href="http://dbpedia.org/property/formerTeammates">http://dbpedia.org/property/formerTeammates</a>                 1
<a class="reference external" href="http://dbpedia.org/property/teammate">http://dbpedia.org/property/teammate</a>                        1
<a class="reference external" href="http://dbpedia.org/property/licenceArea">http://dbpedia.org/property/licenceArea</a>                     1
<a class="reference external" href="http://dbpedia.org/property/protection">http://dbpedia.org/property/protection</a>                      1
<a class="reference external" href="http://dbpedia.org/property/adress">http://dbpedia.org/property/adress</a>                          1
Name: relation, Length: 13954, dtype: int64</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
</section>
</section>
<section id="remove-triples-having-a-relation-starting-with-http-dbpedia-org-ontology-wiki">
<h1>Remove triples having a relation starting with <strong>http://dbpedia.org/ontology/wiki</strong><a class="headerlink" href="#remove-triples-having-a-relation-starting-with-http-dbpedia-org-ontology-wiki" title="Link to this heading"></a></h1>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://dbpedia.org/ontology/wiki’, na=False)]</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>len(df) 525,065,591</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>df = df[df[“subject”].str.startswith(‘&lt;http://dbpedia.org/’)]
len(df) =&gt;  463,352,549</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>df.relation.value_counts()
<a class="reference external" href="http://www.w3.org/2002/07/owl#sameAs">http://www.w3.org/2002/07/owl#sameAs</a>                139366172
<a class="reference external" href="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">http://www.w3.org/1999/02/22-rdf-syntax-ns#type</a>     121181249
<a class="reference external" href="http://dbpedia.org/property/wikiPageUsesTemplate">http://dbpedia.org/property/wikiPageUsesTemplate</a>     60755075
<a class="reference external" href="http://purl.org/dc/terms/subject">http://purl.org/dc/terms/subject</a>                     34356092
<a class="reference external" href="http://www.w3.org/ns/prov#wasDerivedFrom">http://www.w3.org/ns/prov#wasDerivedFrom</a>             20247486
…<br />
<a class="reference external" href="http://dbpedia.org/property/imitates">http://dbpedia.org/property/imitates</a>                        1
<a class="reference external" href="http://dbpedia.org/property/affiliatedClubs">http://dbpedia.org/property/affiliatedClubs</a>                 1
<a class="reference external" href="http://dbpedia.org/property/pmid">http://dbpedia.org/property/pmid</a>                            1
<a class="reference external" href="http://dbpedia.org/property/usNcesDistrictId">http://dbpedia.org/property/usNcesDistrictId</a>                1
<a class="reference external" href="http://dbpedia.org/property/minradius">http://dbpedia.org/property/minradius</a>                       1
Name: relation, Length: 13946, dtype: int64</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
<section id="remove-wikipage-uese-template">
<h1>Remove Wikipage Uese Template<a class="headerlink" href="#remove-wikipage-uese-template" title="Link to this heading"></a></h1>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://dbpedia.org/property/wikiPageUsesTemplate’, na=False)]
402,597,474</p>
</section>
<section id="remove-xmlns">
<h1>Remove xmlns<a class="headerlink" href="#remove-xmlns" title="Link to this heading"></a></h1>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://xmlns.com’, na=False)]
len(df) 376,581,991</p>
<p>df.to_parquet(“dbpedia_only_03_2022”, engine=’pyarrow’) # 376,581,991
#############################################################################</p>
<p>df = df[df[“subject”].str.startswith(‘&lt;http://dbpedia.org/resource/’)]
len(df) =&gt; 716,559,847</p>
<p>df = df[df[“object”].str.startswith(‘&lt;http://dbpedia.org/resource/’,na=False)]
len(df) =&gt; 149,586,877</p>
</section>
<section id="remove-triples-having-a-relation-starting-with-http-dbpedia-org-property-wiki">
<h1>Remove triples having a relation starting with <strong>http://dbpedia.org/property/wiki</strong><a class="headerlink" href="#remove-triples-having-a-relation-starting-with-http-dbpedia-org-property-wiki" title="Link to this heading"></a></h1>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://dbpedia.org/property/wiki’, na=False)]</p>
<p>len(df) =&gt; 735188046</p>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://dbpedia.org/property/wiki’, na=False)]</p>
<p>len(df)  =&gt; 88831385</p>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://purl.org/dc/terms/subject’, na=False)]
len(df) =&gt; 54475293</p>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://www.w3.org/2004/02/skos/core#broader’, na=False)]
len(df) =&gt; 50121317</p>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://purl.org/linguistics/gold/hypernym’, na=False)]
len(df) =&gt; 46107647</p>
<p>df = df[~df[“relation”].str.startswith(‘&lt;http://www.w3.org/2004/02/skos/core#related’, na=False)]
len(df) =&gt; 46107647</p>
<p>df.to_parquet(“dbpedia_only_03_2022”, engine=’pyarrow’) # 46062877</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Caglar Demir.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>